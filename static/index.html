<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Buy-Side Analysis Platform</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 17V7H11V15H13V11H15V15H17V9H19V17H9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M3 21H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M5 21V3H7V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h1>AI Buy-Side Platform</h1>
                </div>
                <div class="theme-toggle">
                    <button id="themeToggle" class="theme-btn">
                        <svg class="theme-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Upload Section -->
            <section id="uploadSection" class="upload-section">
                <div class="upload-container">
                    <div class="upload-header">
                        <h2>Upload Pitch Deck</h2>
                        <p>Extract insights from your PDF using advanced AI analysis</p>
                    </div>
                    
                    <form id="uploadForm" class="upload-form" enctype="multipart/form-data">
                        <div class="file-drop-zone" id="fileDropZone">
                            <input type="file" id="pdfFile" name="file" accept=".pdf" required>
                            <div class="drop-zone-content">
                                <div class="upload-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <h3>Drop your PDF here</h3>
                                <p>or <span class="browse-link">browse files</span></p>
                                <div class="file-requirements">PDF files only ‚Ä¢ Max 50MB</div>
                            </div>
                        </div>
                        
                        <button type="submit" class="upload-btn" id="uploadBtn">
                            <span class="btn-text">Analyze Document</span>
                            <div class="btn-loading hidden">
                                <div class="loading-spinner"></div>
                                <span>Processing...</span>
                            </div>
                        </button>
                    </form>
                </div>
            </section>

            <!-- Loading Section -->
            <section id="loadingSection" class="loading-section hidden">
                <div class="loading-container">
                    <div class="loading-animation">
                        <div class="loading-dots">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>
                    <h3 id="loadingTitle">Processing Document</h3>
                    <p id="loadingSubtitle">Extracting text and preparing analysis...</p>
                    
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="progressPercentage">0%</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section hidden">
                <div class="results-container">
                    <div class="results-header">
                        <h2>Analysis Ready</h2>
                        <p>Choose an AI agent to analyze your pitch deck</p>
                    </div>
                    
                    <div class="agent-grid" id="agentGrid">
                        <div class="agent-card" data-agent="pitchdeck">
                            <div class="agent-header">
                                <div class="agent-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                                        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                                        <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="agent-status"></div>
                            </div>
                            <h3>Executive Summary Agent</h3>
                            <p>Provides executive summary of key business metrics and company highlights</p>
                            <button class="agent-btn">
                                <span>Analyze</span>
                                <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="agent-card" data-agent="product">
                            <div class="agent-header">
                                <div class="agent-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="agent-status"></div>
                            </div>
                            <h3>Quick Checks Agent</h3>
                            <p>Performs rapid VC due diligence checks across problem, market, team, and vision</p>
                            <button class="agent-btn">
                                <span>Analyze</span>
                                <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="agent-card" data-agent="web-research">
                            <div class="agent-header">
                                <div class="agent-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                                        <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="agent-status"></div>
                            </div>
                            <h3>Web Research Agent</h3>
                            <p>Extracts company name and finds latest news and relevant content online</p>
                            <button class="agent-btn">
                                <span>Analyze</span>
                                <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="agent-card" data-agent="market-size">
                            <div class="agent-header">
                                <div class="agent-icon">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="currentColor" stroke-width="2"/>
                                        <polyline points="3.27,6.96 12,12.01 20.73,6.96" stroke="currentColor" stroke-width="2"/>
                                        <line x1="12" y1="22.08" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </div>
                                <div class="agent-status"></div>
                            </div>
                            <h3>Market Size Agent</h3>
                            <p>Estimates TAM, SAM, and SOM using product and company information</p>
                            <button class="agent-btn">
                                <span>Analyze</span>
                                <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Report Generation Section -->
                    <div class="report-generation-section" id="reportSection">
                        <div class="report-header">
                            <h3>üìä Complete Analysis Report</h3>
                            <p>Generate a comprehensive report combining all agent analyses</p>
                        </div>
                        <div class="report-status" id="reportStatus">
                            <div class="agents-status">
                                <span class="agent-status-item" id="statusPitchdeck">üìã Executive Summary</span>
                                <span class="agent-status-item" id="statusProduct">üöÄ Quick Checks</span>
                                <span class="agent-status-item" id="statusResearch">üåê Research</span>
                                <span class="agent-status-item" id="statusMarket">üìà Market</span>
                            </div>
                            <button id="generateReportBtn" class="generate-report-btn" disabled>
                                <span class="btn-text">Generate Complete Report</span>
                                <div class="btn-loading hidden">
                                    <div class="loading-spinner"></div>
                                    <span>Generating...</span>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="extracted-text-section">
                        <details class="text-details">
                            <summary class="text-summary">
                                <span>View Extracted Text</span>
                                <svg class="chevron" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </summary>
                            <div class="text-content">
                                <div id="extractedText" class="extracted-text"></div>
                                <button id="copyBtn" class="copy-btn">
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                    <span>Copy Text</span>
                                </button>
                            </div>
                        </details>
                    </div>
                </div>
            </section>

            <!-- Analysis Section -->
            <section id="analysisSection" class="analysis-section hidden">
                <div class="analysis-container">
                    <div class="analysis-header">
                        <button id="backBtn" class="back-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polyline points="15,18 9,12 15,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Back to Agents</span>
                        </button>
                        <h2 id="analysisTitle">Analysis Results</h2>
                    </div>
                    
                    <div class="analysis-content">
                        <!-- Quick Checks Interactive Analysis - React Style with Tailwind -->
                        <div id="quickChecksAnalysis" class="hidden">
                            <!-- Main Card Container -->
                            <div class="quick-checks-container">
                                <!-- Header Section -->
                                <div class="space-y-2">
                                    <h2 id="companyName" class="company-name">[Company Name]</h2>
                                    <p id="companySector" class="company-sector">Sector: [Sector]</p>
                                </div>

                                <!-- Filter Buttons -->
                                <div class="flex flex-wrap gap-2">
                                    <button class="filter-btn-modern active" data-section="all">Todas</button>
                                    <button class="filter-btn-modern" data-section="problem">Problem</button>
                                    <button class="filter-btn-modern" data-section="market">Market</button>
                                    <button class="filter-btn-modern" data-section="product">Product & Technology</button>
                                    <button class="filter-btn-modern" data-section="team">Team</button>
                                    <button class="filter-btn-modern" data-section="vision">Vision of the Future</button>
                                </div>

                                <!-- Statistics Summary -->
                                <div class="stats-summary">
                                    <span class="stat-item">Total: <span id="totalQuestions" class="stat-value">11</span></span>
                                    <span class="stat-item">Yes: <span id="yesCount" class="stat-value stat-yes">0</span></span>
                                    <span class="stat-item">No: <span id="noCount" class="stat-value stat-no">0</span></span>
                                    <span class="stat-item">NEI: <span id="neiCount" class="stat-value stat-nei">0</span></span>
                                </div>

                                <!-- Main Content Grid -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    <!-- Table Section (Left) -->
                                    <div class="lg:col-span-2">
                                        <div class="space-y-4">
                                            <h3 id="currentSectionTitle" class="section-title">All Questions</h3>
                                            
                                            <!-- Modern Table -->
                                            <div class="table-container">
                                                <div class="overflow-x-auto">
                                                    <table class="w-full">
                                                        <thead class="table-header">
                                                            <tr>
                                                                <th class="table-header-cell">Pergunta</th>
                                                                <th class="table-header-cell">Resposta</th>
                                                                <th class="table-header-cell">Justificativa</th>
                                                                <th class="table-header-cell text-center">Grade</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="questionsTableBody" class="table-body">
                                                            <!-- Table rows will be dynamically populated -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div id="tableCaption" class="table-caption">
                                                    Items from "All Questions" section.
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Score Panel (Right) -->
                                    <div class="lg:col-span-1">
                                        <div class="score-panel">
                                            <!-- Circular Progress Chart -->
                                            <div class="flex flex-col items-center space-y-4">
                                                <div class="relative w-32 h-32">
                                                    <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                                        <!-- Background circle -->
                                                        <circle cx="60" cy="60" r="50" fill="none" stroke="rgb(51 65 85)" stroke-width="8"/>
                                                        <!-- Progress circle -->
                                                        <circle id="progressCircle" cx="60" cy="60" r="50" fill="none" stroke="url(#gradient)" 
                                                            stroke-width="8" stroke-linecap="round" stroke-dasharray="314.16" stroke-dashoffset="314.16"
                                                            class="transition-all duration-1000 ease-out"/>
                                                        <!-- Gradient definition -->
                                                        <defs>
                                                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                                                <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                                                                <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                                                            </linearGradient>
                                                        </defs>
                                                    </svg>
                                                    <!-- Score text overlay -->
                                                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                                                        <span id="scoreValue" class="score-value">0.0</span>
                                                        <span class="score-label">Score</span>
                                                    </div>
                                                </div>
                                                
                                                <p class="score-description">Pontua√ß√£o (0-10)</p>
                                            </div>

                                            <!-- Score Breakdown -->
                                            <div class="space-y-2">
                                                <div class="breakdown-item-modern" data-section="problem">
                                                    <span class="section-label">Problem</span>
                                                    <span class="section-score">-</span>
                                                </div>
                                                <div class="breakdown-item-modern" data-section="market">
                                                    <span class="section-label">Market</span>
                                                    <span class="section-score">-</span>
                                                </div>
                                                <div class="breakdown-item-modern" data-section="product">
                                                    <span class="section-label">Product</span>
                                                    <span class="section-score">-</span>
                                                </div>
                                                <div class="breakdown-item-modern" data-section="team">
                                                    <span class="section-label">Team</span>
                                                    <span class="section-score">-</span>
                                                </div>
                                                <div class="breakdown-item-modern" data-section="vision">
                                                    <span class="section-label">Vision</span>
                                                    <span class="section-score">-</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Executive Summary Display -->
                        <div id="executiveSummaryAnalysis" class="hidden">
                            <!-- Main Container -->
                            <div class="executive-summary-container">
                                <!-- Header Card -->
                                <div class="executive-header-card">
                                    <h1 id="executiveCompanyName" class="executive-company-name">[Company Name]</h1>
                                    <span id="executiveSector" class="executive-sector-badge">Sector: [Sector]</span>
                                </div>

                                <!-- Main Grid Layout -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                    <!-- Left Column - Main Content (2/3 width) -->
                                    <div class="lg:col-span-2 space-y-6">
                                        <!-- Company Overview Card -->
                                        <div class="executive-content-card">
                                            <h2 class="executive-section-title">Company Overview</h2>
                                            <ul id="executiveOverview" class="executive-bullet-list">
                                                <!-- Bullets will be populated here -->
                                            </ul>
                                        </div>

                                        <!-- Product Card -->
                                        <div class="executive-content-card">
                                            <h2 class="executive-section-title">Product</h2>
                                            <ul id="executiveProduct" class="executive-bullet-list">
                                                <!-- Bullets will be populated here -->
                                            </ul>
                                        </div>

                                        <!-- Business Model Card -->
                                        <div class="executive-content-card">
                                            <h2 class="executive-section-title">Business Model</h2>
                                            <ul id="executiveBusinessModel" class="executive-bullet-list">
                                                <!-- Bullets will be populated here -->
                                            </ul>
                                        </div>

                                        <!-- Team Card -->
                                        <div class="executive-content-card">
                                            <h2 class="executive-section-title">Team</h2>
                                            <ul id="executiveTeam" class="executive-bullet-list">
                                                <!-- Bullets will be populated here -->
                                            </ul>
                                        </div>
                                    </div>

                                    <!-- Right Column - Sidebar (1/3 width) -->
                                    <div class="lg:col-span-1 space-y-6">
                                        <!-- Quick Facts Card -->
                                        <div class="executive-sidebar-card">
                                            <h3 class="executive-sidebar-title">Quick Facts</h3>
                                            <div class="executive-facts-grid">
                                                <div class="executive-fact-item">
                                                    <span class="executive-fact-label">Stage</span>
                                                    <span id="executiveStage" class="executive-fact-value">Not specified</span>
                                                </div>
                                                <div class="executive-fact-item">
                                                    <span class="executive-fact-label">HQ</span>
                                                    <span id="executiveHQ" class="executive-fact-value">Not specified</span>
                                                </div>
                                                <div class="executive-fact-item">
                                                    <span class="executive-fact-label">Founded</span>
                                                    <span id="executiveFounded" class="executive-fact-value">Not specified</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Market Opportunity Card -->
                                        <div class="executive-sidebar-card">
                                            <h3 class="executive-sidebar-title">Market Opportunity</h3>
                                            <ul id="executiveMarketOpportunity" class="executive-bullet-list">
                                                <!-- Bullets will be populated here -->
                                            </ul>
                                        </div>

                                        <!-- Traction & Metrics Card -->
                                        <div class="executive-sidebar-card">
                                            <h3 class="executive-sidebar-title">Traction & Metrics</h3>
                                            <ul id="executiveTraction" class="executive-bullet-list">
                                                <!-- Bullets will be populated here -->
                                            </ul>
                                        </div>

                                        <!-- Actions Card -->
                                        <div class="executive-sidebar-card">
                                            <h3 class="executive-sidebar-title">Actions</h3>
                                            <div class="executive-actions-grid">
                                                <button id="copyExecutiveSummaryBtn" class="executive-action-btn executive-action-primary">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2"/>
                                                    </svg>
                                                    Copy Summary
                                                </button>
                                                <button id="exportExecutiveJSONBtn" class="executive-action-btn executive-action-secondary">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2"/>
                                                    </svg>
                                                    Export JSON
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Regular Analysis Display -->
                        <div id="regularAnalysis" class="regular-analysis">
                            <div id="analysisText" class="analysis-text"></div>
                        </div>
                        
                        <div class="analysis-actions">
                            <button id="copyAnalysisBtn" class="copy-btn">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span>Copy Analysis</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Report Section -->
            <section id="reportDisplaySection" class="report-display-section hidden">
                <div class="report-display-container">
                    <div class="report-display-header">
                        <button id="backToResultsBtn" class="back-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <polyline points="15,18 9,12 15,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Back to Results</span>
                        </button>
                        <h2>üìä Comprehensive Business Report</h2>
                        <div class="report-actions">
                            <button id="copyReportBtn" class="copy-btn">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                <span>Copy Report</span>
                            </button>
                            <button id="downloadReportBtn" class="download-btn">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>Download</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-content">
                        <div id="reportContent" class="report-text"></div>
                    </div>
                </div>
            </section>

            <!-- Error Section -->
            <div id="errorSection" class="error-section hidden">
                <div class="error-container">
                    <div class="error-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                            <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <h3>Something went wrong</h3>
                    <p id="errorMessage">An unexpected error occurred</p>
                    <button id="retryBtn" class="retry-btn">Try Again</button>
                </div>
            </div>
        </main>

        <!-- Toast Notifications -->
        <div id="toastContainer" class="toast-container"></div>
    </div>

    <script>
        // DOM Elements
        const uploadForm = document.getElementById('uploadForm');
        const uploadSection = document.getElementById('uploadSection');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');
        const analysisSection = document.getElementById('analysisSection');
        const reportDisplaySection = document.getElementById('reportDisplaySection');
        const errorSection = document.getElementById('errorSection');
        
        const fileDropZone = document.getElementById('fileDropZone');
        const pdfFileInput = document.getElementById('pdfFile');
        const uploadBtn = document.getElementById('uploadBtn');
        const loadingTitle = document.getElementById('loadingTitle');
        const loadingSubtitle = document.getElementById('loadingSubtitle');
        const progressFill = document.getElementById('progressFill');
        const progressPercentage = document.getElementById('progressPercentage');
        
        const extractedTextDiv = document.getElementById('extractedText');
        const copyBtn = document.getElementById('copyBtn');
        const analysisTextDiv = document.getElementById('analysisText');
        const analysisTitle = document.getElementById('analysisTitle');
        const copyAnalysisBtn = document.getElementById('copyAnalysisBtn');
        const backBtn = document.getElementById('backBtn');
        const errorMessage = document.getElementById('errorMessage');
        const retryBtn = document.getElementById('retryBtn');
        const themeToggle = document.getElementById('themeToggle');
        const toastContainer = document.getElementById('toastContainer');
        
        // Report elements
        const generateReportBtn = document.getElementById('generateReportBtn');
        const reportContent = document.getElementById('reportContent');
        const copyReportBtn = document.getElementById('copyReportBtn');
        const downloadReportBtn = document.getElementById('downloadReportBtn');
        const backToResultsBtn = document.getElementById('backToResultsBtn');
        
        // Agent status elements
        const statusPitchdeck = document.getElementById('statusPitchdeck');
        const statusProduct = document.getElementById('statusProduct');
        const statusResearch = document.getElementById('statusResearch');
        const statusMarket = document.getElementById('statusMarket');
        
        const agentCards = document.querySelectorAll('.agent-card');
        
        let currentExtractedText = '';
        let agentCache = {};
        let currentTextHash = '';
        let reportCache = null;
        let completedAgents = new Set();
        let agentResults = {};
        
        // Theme Management
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const currentTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', currentTheme);
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
        
        // Toast Notification System
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <span>${message}</span>
                    <button class="toast-close">√ó</button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove
            const autoRemove = setTimeout(() => removeToast(toast), duration);
            
            // Manual close
            toast.querySelector('.toast-close').addEventListener('click', () => {
                clearTimeout(autoRemove);
                removeToast(toast);
            });
        }
        
        function removeToast(toast) {
            toast.classList.remove('show');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }
        
        // Simple hash function for caching
        function hashText(text) {
            let hash = 0;
            if (text.length === 0) return hash;
            for (let i = 0; i < text.length; i++) {
                const char = text.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString();
        }
        
        // File Drop Zone
        fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropZone.classList.add('drag-over');
        });
        
        fileDropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('drag-over');
        });
        
        fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                pdfFileInput.files = files;
                updateFileLabel(files[0]);
            } else {
                showToast('Please drop a valid PDF file', 'error');
            }
        });
        
        pdfFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                updateFileLabel(this.files[0]);
            }
        });
        
        function updateFileLabel(file) {
            const dropZoneContent = fileDropZone.querySelector('.drop-zone-content h3');
            dropZoneContent.textContent = file.name;
        }
        
        // Section Management
        function hideAllSections() {
            uploadSection.classList.add('hidden');
            loadingSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            analysisSection.classList.add('hidden');
            reportDisplaySection.classList.add('hidden');
            errorSection.classList.add('hidden');
        }
        
        function showSection(section) {
            hideAllSections();
            section.classList.remove('hidden');
        }
        
        function showLoading(title = 'Processing Document', subtitle = 'This may take a few moments...') {
            loadingTitle.textContent = title;
            loadingSubtitle.textContent = subtitle;
            resetProgressBar();
            showSection(loadingSection);
        }
        
        function updateProgress(percentage) {
            progressFill.style.width = percentage + '%';
            progressPercentage.textContent = percentage + '%';
        }
        
        function resetProgressBar() {
            updateProgress(0);
        }
        
        function simulateProgress(targetPercentage, duration = 2000) {
            const currentPercentage = parseInt(progressFill.style.width) || 0;
            const increment = (targetPercentage - currentPercentage) / (duration / 100);
            let current = currentPercentage;
            
            const interval = setInterval(() => {
                current += increment;
                if (current >= targetPercentage) {
                    current = targetPercentage;
                    clearInterval(interval);
                }
                updateProgress(Math.round(current));
            }, 100);
        }
        
        function showError(message, showRetry = true) {
            errorMessage.textContent = message;
            retryBtn.style.display = showRetry ? 'block' : 'none';
            showSection(errorSection);
            showToast(message, 'error');
        }
        
        // Form Submission
        uploadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const file = pdfFileInput.files[0];
            if (!file) {
                showToast('Please select a PDF file', 'error');
                return;
            }
            
            if (file.type !== 'application/pdf') {
                showToast('Please select a valid PDF file', 'error');
                return;
            }
            
            if (file.size > 50 * 1024 * 1024) { // 50MB limit
                showToast('File size too large. Please select a file under 50MB', 'error');
                return;
            }
            
            showLoading('Processing PDF', 'Extracting text using AI...');
            
            // Start progress simulation
            simulateProgress(20, 1000); // 0-20% during upload prep
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                // Simulate upload progress
                simulateProgress(50, 2000); // 20-50% during upload
                
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                // Simulate processing progress
                simulateProgress(80, 1500); // 50-80% during processing
                
                const data = await response.json();
                
                if (data.success) {
                    // Complete the progress bar
                    updateProgress(100);
                    
                    // Small delay to show 100% completion
                    setTimeout(() => {
                        currentExtractedText = data.extracted_text;
                        currentTextHash = hashText(data.extracted_text);
                        agentCache = {};
                        showResults(data.extracted_text);
                        showToast('PDF processed successfully!', 'success');
                    }, 500);
                } else {
                    showError(data.detail || 'Failed to process PDF');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        });
        
        function showResults(text) {
            extractedTextDiv.textContent = text;
            // Reset report state
            completedAgents.clear();
            agentResults = {};
            reportCache = null;
            updateReportButtonState();
            updateAgentStatusDisplay();
            showSection(resultsSection);
        }
        
        // Report Management Functions
        function updateAgentStatusDisplay() {
            const statusElements = {
                'pitchdeck': statusPitchdeck,
                'product': statusProduct,
                'web-research': statusResearch,
                'market-size': statusMarket
            };
            
            Object.keys(statusElements).forEach(agentType => {
                const element = statusElements[agentType];
                if (completedAgents.has(agentType)) {
                    element.classList.add('completed');
                } else {
                    element.classList.remove('completed');
                }
            });
        }
        
        function updateReportButtonState() {
            const allAgentsCompleted = completedAgents.size === 4;
            generateReportBtn.disabled = !allAgentsCompleted;
            
            if (allAgentsCompleted) {
                generateReportBtn.classList.add('ready');
            } else {
                generateReportBtn.classList.remove('ready');
            }
        }
        
        function markAgentCompleted(agentType, result) {
            completedAgents.add(agentType);
            agentResults[agentType] = result;
            updateAgentStatusDisplay();
            updateReportButtonState();
            
            if (completedAgents.size === 4) {
                showToast('All analyses complete! You can now generate the full report.', 'success', 5000);
            }
        }
        
        // Agent Handling
        agentCards.forEach(card => {
            const agentBtn = card.querySelector('.agent-btn');
            const agentType = card.getAttribute('data-agent');
            const agentStatus = card.querySelector('.agent-status');
            
            agentBtn.addEventListener('click', async function() {
                if (!currentExtractedText) {
                    showToast('No extracted text available', 'error');
                    return;
                }
                
                // Check cache first
                const cacheKey = `${currentTextHash}_${agentType}`;
                if (agentCache[cacheKey]) {
                    // Mark agent as completed if using cached result
                    if (!completedAgents.has(agentType)) {
                        markAgentCompleted(agentType, {
                            content: agentCache[cacheKey],
                            cached: true
                        });
                    }
                    showAnalysis(agentCache[cacheKey], getAgentTitle(agentType, true));
                    return;
                }
                
                // Show loading state
                agentBtn.disabled = true;
                agentBtn.innerHTML = '<span>Analyzing...</span>';
                agentStatus.classList.add('loading');
                
                showLoading('Running Analysis', `${getAgentTitle(agentType).replace(' Analysis', ' Agent')} is processing your document...`);
                
                // Start progress for agent analysis
                simulateProgress(30, 1000);
                
                try {
                    const endpoint = getAgentEndpoint(agentType);
                    if (!endpoint) {
                        showError('Agent not available yet');
                        return;
                    }
                    
                    // Simulate analysis progress
                    simulateProgress(70, 1500);
                    
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            extracted_text: currentExtractedText
                        })
                    });
                    
                    simulateProgress(90, 500);
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        updateProgress(100);
                        
                        setTimeout(() => {
                            let analysisContent = formatAnalysisContent(data, agentType);
                            
                            // Cache the result
                            agentCache[cacheKey] = analysisContent;
                            agentStatus.classList.add('completed');
                            
                            // Mark agent as completed for report generation
                            markAgentCompleted(agentType, {
                                content: analysisContent,
                                rawData: data
                            });
                            
                            showAnalysis(analysisContent, getAgentTitle(agentType));
                            showToast('Analysis completed!', 'success');
                        }, 300);
                    } else {
                        showError(data.detail || 'Analysis failed');
                    }
                } catch (error) {
                    showError('Analysis error: ' + error.message);
                } finally {
                    agentBtn.disabled = false;
                    agentBtn.innerHTML = `
                        <span>Analyze</span>
                        <svg class="btn-arrow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    `;
                    agentStatus.classList.remove('loading');
                }
            });
        });
        
        function getAgentEndpoint(agentType) {
            const endpoints = {
                'pitchdeck': '/analyze',
                'product': '/analyze_product',
                'web-research': '/research_company',
                'market-size': '/analyze_market_size'
            };
            return endpoints[agentType];
        }
        
        function getAgentTitle(agentType, cached = false) {
            const titles = {
                'pitchdeck': 'Executive Summary Analysis',
                'product': 'Quick Checks Analysis',
                'web-research': 'Web Research Analysis',
                'market-size': 'Market Size Analysis'
            };
            return titles[agentType] + (cached ? ' (Cached)' : '');
        }
        
        function formatAnalysisContent(data, agentType) {
            if (agentType === 'web-research') {
                return `Company: ${data.company_name}\n\n${data.research_content}`;
            } else if (agentType === 'market-size') {
                return data.market_analysis;
            } else {
                return data.analysis;
            }
        }
        
        // Simple markdown to HTML converter for basic formatting
        function markdownToHtml(markdown) {
            let html = markdown
                // Headers
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                
                // Bold text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                
                // Bullet points
                .replace(/^- (.*$)/gm, '<li>$1</li>')
                
                // Links
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                
                // Line breaks
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            
            // Wrap in paragraph tags and handle lists
            html = '<p>' + html + '</p>';
            
            // Clean up list formatting
            html = html.replace(/<p><li>/g, '<ul><li>');
            html = html.replace(/<\/li><\/p>/g, '</li></ul>');
            html = html.replace(/<\/li><br><li>/g, '</li><li>');
            
            // Clean up empty paragraphs
            html = html.replace(/<p><\/p>/g, '');
            html = html.replace(/<p><br><\/p>/g, '');
            
            return html;
        }
        
        function showAnalysis(content, title) {
            analysisTitle.textContent = title;
            
            // Check if this is a Quick Checks Analysis
            if (title.includes('Quick Checks')) {
                showQuickChecksAnalysis(content, title);
            } else if (title.includes('Executive Summary')) {
                showExecutiveSummaryAnalysis(content, title);
            } else {
                showRegularAnalysis(content, title);
            }
            
            showSection(analysisSection);
        }
        
        function showRegularAnalysis(content, title) {
            const quickChecksDiv = document.getElementById('quickChecksAnalysis');
            const regularDiv = document.getElementById('regularAnalysis');
            
            quickChecksDiv.classList.add('hidden');
            regularDiv.classList.remove('hidden');
            
            // Check if content appears to be markdown (contains # headers or ** bold)
            if (content.includes('#') || content.includes('**')) {
                analysisTextDiv.innerHTML = markdownToHtml(content);
            } else {
                analysisTextDiv.textContent = content;
            }
        }
        
        function showQuickChecksAnalysis(content, title) {
            const quickChecksDiv = document.getElementById('quickChecksAnalysis');
            const regularDiv = document.getElementById('regularAnalysis');
            
            quickChecksDiv.classList.remove('hidden');
            regularDiv.classList.add('hidden');
            
            // Parse the Quick Checks content
            const parsedData = parseQuickChecksContent(content);
            
            // Populate the interactive interface
            populateQuickChecksInterface(parsedData);
        }
        
        function parseQuickChecksContent(content) {
            const lines = content.split('\n').filter(line => line.trim());
            let currentSection = '';
            const sections = {};
            let companyName = '';
            let sector = '';
            let overallScore = 0;
            
            // Extract company name and sector
            for (let i = 0; i < Math.min(lines.length, 5); i++) {
                const line = lines[i].trim();
                if (!line.includes('üîπ') && !line.includes('‚û°Ô∏è') && line.length > 0) {
                    if (line.toLowerCase().includes('sector:')) {
                        sector = line.replace(/sector:\s*/i, '').trim();
                    } else if (!companyName && !line.includes('[') && line.length > 2) {
                        companyName = line;
                    }
                }
            }
            
            // Define section patterns
            const sectionPatterns = {
                'problem': /^Problem\s*$/i,
                'market': /^Market\s*$/i,
                'product': /^Product & Technology\s*$/i,
                'team': /^Team\s*$/i,
                'vision': /^Vision of the Future\s*$/i
            };
            
            // Parse sections and questions
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Check for section headers
                for (const [key, pattern] of Object.entries(sectionPatterns)) {
                    if (pattern.test(line)) {
                        currentSection = key;
                        sections[currentSection] = { questions: [], scores: [] };
                        break;
                    }
                }
                
                // Check for questions
                if (line.startsWith('üîπ') && currentSection) {
                    const questionText = line.replace('üîπ', '').trim();
                    let answer = '';
                    let justification = '';
                    let score = null;
                    
                    // Look for answer and score in next lines (extended search)
                    for (let j = i + 1; j < Math.min(i + 5, lines.length); j++) {
                        const nextLine = lines[j].trim();
                        
                        // Check for answer line
                        if (nextLine.match(/^(Yes|No|Not enough information)/i)) {
                            const parts = nextLine.split('‚Äì');
                            answer = parts[0].trim();
                            justification = parts.length > 1 ? parts[1].trim() : '';
                        }
                        
                        // Check for score line (should come after answer/justification)
                        else if (nextLine.match(/^\d+(\.\d+)?$/) && answer) {
                            score = parseFloat(nextLine);
                            sections[currentSection].scores.push(score);
                            break; // Found score, move to next question
                        }
                        
                        // Stop if we hit another question or section
                        if (nextLine.startsWith('üîπ') || Object.values(sectionPatterns).some(pattern => pattern.test(nextLine))) {
                            break;
                        }
                    }
                    
                    sections[currentSection].questions.push({
                        text: questionText,
                        answer: answer,
                        justification: justification,
                        score: score
                    });
                }
                
                // Check for overall score
                if (line.includes('‚û°Ô∏è') && line.toLowerCase().includes('score')) {
                    const scoreMatch = line.match(/(\d+(\.\d+)?)/);
                    if (scoreMatch) {
                        overallScore = parseFloat(scoreMatch[1]);
                    }
                }
            }
            
            // Calculate overall score as average of all individual scores if not provided
            if (overallScore === 0) {
                const allScores = Object.values(sections).flatMap(section => section.scores);
                if (allScores.length > 0) {
                    overallScore = allScores.reduce((sum, score) => sum + score, 0) / allScores.length;
                }
            }
            
            return {
                companyName: companyName || '[Company Name]',
                sector: sector || '[Sector]',
                sections: sections,
                overallScore: overallScore
            };
        }
        
        function populateQuickChecksInterface(data) {
            // Update company info
            document.getElementById('companyName').textContent = data.companyName;
            document.getElementById('companySector').textContent = `Sector: ${data.sector}`;
            
            // Store data globally for filtering
            window.quickChecksData = data;
            
            // Calculate and display statistics
            updateQuestionStats(data);
            
            // Update score visualization
            updateScoreVisualization(data);
            
            // Display all questions initially
            displayQuestions('all');
            
            // Set up filter button handlers
            setupFilterButtons();
        }
        
        function updateQuestionStats(data) {
            let totalQuestions = 0;
            let yesCount = 0;
            let noCount = 0;
            let neiCount = 0;
            
            Object.values(data.sections).forEach(section => {
                section.questions.forEach(question => {
                    totalQuestions++;
                    const answer = question.answer.toLowerCase();
                    if (answer.includes('yes')) {
                        yesCount++;
                    } else if (answer.includes('no') && !answer.includes('not enough')) {
                        noCount++;
                    } else if (answer.includes('not enough')) {
                        neiCount++;
                    }
                });
            });
            
            document.getElementById('totalQuestions').textContent = totalQuestions;
            document.getElementById('yesCount').textContent = yesCount;
            document.getElementById('noCount').textContent = noCount;
            document.getElementById('neiCount').textContent = neiCount;
        }
        
        function updateScoreVisualization(data) {
            const scoreValue = document.getElementById('scoreValue');
            const progressCircle = document.getElementById('progressCircle');
            
            // Calculate overall score using SQL-like aggregation (average of all individual question scores)
            const allIndividualScores = Object.values(data.sections)
                .flatMap(section => section.questions)
                .map(question => question.score)
                .filter(score => score !== null && score !== undefined);
            
            let calculatedOverallScore = data.overallScore;
            if (allIndividualScores.length > 0) {
                calculatedOverallScore = allIndividualScores.reduce((sum, score) => sum + score, 0) / allIndividualScores.length;
            }
            
            // Update main score display
            scoreValue.textContent = calculatedOverallScore.toFixed(1);
            
            // Calculate progress percentage (0-10 scale to 0-100%)
            const percentage = (calculatedOverallScore / 10) * 100;
            const circumference = 2 * Math.PI * 50; // radius = 50
            const offset = circumference - (percentage / 100) * circumference;
            
            // Animate the circular progress
            setTimeout(() => {
                progressCircle.style.strokeDashoffset = offset;
            }, 100);
            
            // Update section scores using SQL-like GROUP BY aggregation
            Object.entries(data.sections).forEach(([sectionKey, section]) => {
                const scoreElement = document.querySelector(`[data-section="${sectionKey}"] .section-score`);
                if (scoreElement) {
                    // Calculate category average using individual question scores (not section.scores)
                    const sectionScores = section.questions
                        .map(question => question.score)
                        .filter(score => score !== null && score !== undefined);
                    
                    if (sectionScores.length > 0) {
                        const avgScore = sectionScores.reduce((sum, score) => sum + score, 0) / sectionScores.length;
                        scoreElement.textContent = avgScore.toFixed(1);
                    } else {
                        scoreElement.textContent = '-';
                    }
                }
            });
        }
        
        function displayQuestions(filterSection) {
            const tableBody = document.getElementById('questionsTableBody');
            const titleElement = document.getElementById('currentSectionTitle');
            const data = window.quickChecksData;
            
            if (!data) return;
            
            tableBody.innerHTML = '';
            
            // Update title
            if (filterSection === 'all') {
                titleElement.textContent = 'All Questions';
            } else {
                const sectionNames = {
                    'problem': 'Problem',
                    'market': 'Market',
                    'product': 'Product & Technology',
                    'team': 'Team',
                    'vision': 'Vision of the Future'
                };
                titleElement.textContent = sectionNames[filterSection] || 'Questions';
            }
            
            // Get questions to display
            let questionsToShow = [];
            if (filterSection === 'all') {
                Object.entries(data.sections).forEach(([sectionKey, section]) => {
                    section.questions.forEach(question => {
                        questionsToShow.push({ ...question, section: sectionKey });
                    });
                });
            } else if (data.sections[filterSection]) {
                questionsToShow = data.sections[filterSection].questions.map(q => ({ ...q, section: filterSection }));
            }
            
            // Create table rows
            questionsToShow.forEach(question => {
                const tableRow = createTableRow(question);
                tableBody.appendChild(tableRow);
            });
        }
        
        function createTableRow(question) {
            const row = document.createElement('tr');
            row.className = 'table-row-modern';
            
            // Determine answer class
            let answerClass = 'nei';
            const answer = question.answer.toLowerCase();
            if (answer.includes('yes')) {
                answerClass = 'yes';
            } else if (answer.includes('no') && !answer.includes('not enough')) {
                answerClass = 'no';
            }
            
            row.innerHTML = `
                <td class="table-cell">
                    <div class="table-question-text">${question.text}</div>
                </td>
                <td class="table-cell">
                    <span class="answer-badge-modern ${answerClass}">${question.answer}</span>
                </td>
                <td class="table-cell">
                    <div class="table-justification-text">${question.justification}</div>
                </td>
                <td class="table-cell text-center">
                    ${question.score !== null ? `<span class="grade-badge-modern">${question.score}</span>` : '<span class="table-no-score">-</span>'}
                </td>
            `;
            
            return row;
        }
        
        
        function setupFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-btn-modern');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Get the section to filter
                    const section = button.getAttribute('data-section');
                    
                    // Display filtered questions
                    displayQuestions(section);
                    
                    // Update table caption
                    updateTableCaption(section);
                });
            });
        }
        
        function updateTableCaption(section) {
            const tableCaption = document.getElementById('tableCaption');
            const sectionNames = {
                'all': 'All Questions',
                'problem': 'Problem',
                'market': 'Market',
                'product': 'Product & Technology',
                'team': 'Team',
                'vision': 'Vision of the Future'
            };
            const sectionName = sectionNames[section] || 'Questions';
            tableCaption.textContent = `Items from "${sectionName}" section.`;
        }
        
        // Executive Summary Functions
        function showExecutiveSummaryAnalysis(content, title) {
            const quickChecksDiv = document.getElementById('quickChecksAnalysis');
            const regularDiv = document.getElementById('regularAnalysis');
            const executiveDiv = document.getElementById('executiveSummaryAnalysis');
            
            quickChecksDiv.classList.add('hidden');
            regularDiv.classList.add('hidden');
            executiveDiv.classList.remove('hidden');
            
            // Parse the Executive Summary content
            const parsedData = parseExecutiveSummaryContent(content);
            
            // Populate the interface
            populateExecutiveSummaryInterface(parsedData);
        }
        
        function parseExecutiveSummaryContent(content) {
            const lines = content.split('\n').filter(line => line.trim());
            let companyName = '';
            let sector = '';
            let stage = 'Not specified';
            let hq = 'Not specified';
            let founded = 'Not specified';
            
            const sections = {
                overview: [],
                product: [],
                businessModel: [],
                marketOpportunity: [],
                traction: [],
                team: []
            };
            
            let currentSection = '';
            let i = 0;
            let inQuickFacts = false;
            
            // Parse through all lines
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // Extract company name and sector from first few lines
                if (i < 5) {
                    if (line.toLowerCase().startsWith('sector:')) {
                        sector = line.replace(/sector:\s*/i, '').trim();
                    } else if (!line.includes('üîπ') && line.length > 2 && !companyName && !line.toLowerCase().includes('sector')) {
                        // Handle company name with or without # prefix
                        let cleanName = line.replace(/^#+\s*/, '').trim(); // Remove # prefix
                        if (cleanName && cleanName !== 'Company Overview' && cleanName !== 'Product' && cleanName !== 'Business Model') {
                            companyName = cleanName;
                        }
                    }
                }
                
                // Check for Quick Facts section
                if (line.toLowerCase().includes('quick facts')) {
                    inQuickFacts = true;
                    currentSection = '';
                } else if (inQuickFacts && !line.startsWith('[') && line.length > 0) {
                    // Parse Quick Facts data - look for lines that aren't placeholders
                    if (!line.includes('[Insert') && !line.includes('üîπ')) {
                        // Check what type of fact this might be
                        const lowerLine = line.toLowerCase();
                        if (lowerLine.includes('series') || lowerLine.includes('stage') || lowerLine.includes('round')) {
                            stage = line;
                        } else if (lowerLine.includes(',') && (lowerLine.includes('usa') || lowerLine.includes('canada') || lowerLine.includes('uk') || lowerLine.includes('france') || lowerLine.includes('germany') || lowerLine.includes('üá∫üá∏') || lowerLine.includes('üá®üá¶') || lowerLine.includes('üá¨üáß') || lowerLine.includes('üá´üá∑') || lowerLine.includes('üá©üá™'))) {
                            hq = line;
                        } else if (line.match(/^\d{4}$/) || line.match(/\d{4}/)) {
                            founded = line;
                        }
                    }
                }
                
                // Check for section headers (only when not in Quick Facts)
                if (!inQuickFacts) {
                    const cleanLine = line.replace(/^#+\s*/, '').toLowerCase(); // Remove markdown headers
                    if (cleanLine.includes('company overview')) {
                        currentSection = 'overview';
                    } else if (cleanLine.includes('product') && !line.includes('üîπ')) {
                        currentSection = 'product';
                    } else if (cleanLine.includes('business model')) {
                        currentSection = 'businessModel';
                    } else if (cleanLine.includes('market opportunity')) {
                        currentSection = 'marketOpportunity';
                    } else if (cleanLine.includes('traction') || cleanLine.includes('metrics')) {
                        currentSection = 'traction';
                    } else if (cleanLine.includes('team') && !line.includes('üîπ')) {
                        currentSection = 'team';
                    }
                }
                
                // Reset inQuickFacts when we hit a main section
                const cleanLineForReset = line.replace(/^#+\s*/, '').toLowerCase();
                if (cleanLineForReset.includes('company overview') || 
                    cleanLineForReset.includes('product') || 
                    cleanLineForReset.includes('business model') || 
                    cleanLineForReset.includes('market opportunity') || 
                    cleanLineForReset.includes('traction') || 
                    cleanLineForReset.includes('team')) {
                    inQuickFacts = false;
                }
                
                // Extract bullet points for main sections
                if (line.startsWith('üîπ') && currentSection && !inQuickFacts) {
                    const bulletText = line.replace('üîπ', '').trim();
                    // Check if this is actual content or a placeholder
                    const isPlaceholder = bulletText.startsWith('[') && bulletText.endsWith(']');
                    const isNotSpecified = bulletText.toLowerCase() === 'not specified';
                    
                    if (bulletText && !isPlaceholder && !isNotSpecified) {
                        sections[currentSection].push(bulletText);
                    }
                }
                
                i++;
            }
            
            return {
                companyName: companyName || '[Company Name]',
                sector: sector || '[Sector]',
                stage: stage,
                hq: hq,
                founded: founded,
                sections: sections
            };
        }
        
        function populateExecutiveSummaryInterface(data) {
            // Update company info
            document.getElementById('executiveCompanyName').textContent = data.companyName;
            document.getElementById('executiveSector').textContent = `Sector: ${data.sector}`;
            
            // Update Quick Facts
            document.getElementById('executiveStage').textContent = data.stage;
            document.getElementById('executiveHQ').textContent = data.hq;
            document.getElementById('executiveFounded').textContent = data.founded;
            
            // Add not-specified class if needed
            const stageElement = document.getElementById('executiveStage');
            const hqElement = document.getElementById('executiveHQ');
            const foundedElement = document.getElementById('executiveFounded');
            
            if (data.stage === 'Not specified') stageElement.classList.add('not-specified');
            else stageElement.classList.remove('not-specified');
            
            if (data.hq === 'Not specified') hqElement.classList.add('not-specified');
            else hqElement.classList.remove('not-specified');
            
            if (data.founded === 'Not specified') foundedElement.classList.add('not-specified');
            else foundedElement.classList.remove('not-specified');
            
            // Populate sections
            populateExecutiveSection('executiveOverview', data.sections.overview);
            populateExecutiveSection('executiveProduct', data.sections.product);
            populateExecutiveSection('executiveBusinessModel', data.sections.businessModel);
            populateExecutiveSection('executiveMarketOpportunity', data.sections.marketOpportunity);
            populateExecutiveSection('executiveTraction', data.sections.traction);
            populateExecutiveSection('executiveTeam', data.sections.team);
            
            // Store data globally for actions
            window.executiveSummaryData = data;
            
            // Set up action button handlers
            setupExecutiveActionButtons();
        }
        
        function populateExecutiveSection(elementId, bullets) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            
            if (bullets.length === 0) {
                const li = document.createElement('li');
                li.className = 'not-specified';
                li.textContent = 'Not specified';
                element.appendChild(li);
            } else {
                bullets.forEach(bullet => {
                    const li = document.createElement('li');
                    li.textContent = bullet;
                    element.appendChild(li);
                });
            }
        }
        
        function setupExecutiveActionButtons() {
            const copyBtn = document.getElementById('copyExecutiveSummaryBtn');
            const exportBtn = document.getElementById('exportExecutiveJSONBtn');
            
            copyBtn.addEventListener('click', async () => {
                try {
                    const data = window.executiveSummaryData;
                    const summaryText = generateExecutiveSummaryText(data);
                    await navigator.clipboard.writeText(summaryText);
                    showToast('Executive summary copied to clipboard!', 'success');
                } catch (err) {
                    showToast('Failed to copy summary', 'error');
                }
            });
            
            exportBtn.addEventListener('click', async () => {
                try {
                    const data = window.executiveSummaryData;
                    const jsonData = {
                        company: data.companyName,
                        sector: data.sector,
                        overview: data.sections.overview,
                        product: data.sections.product,
                        businessModel: data.sections.businessModel,
                        marketOpportunity: data.sections.marketOpportunity,
                        traction: data.sections.traction,
                        team: data.sections.team
                    };
                    
                    await navigator.clipboard.writeText(JSON.stringify(jsonData, null, 2));
                    showToast('JSON data copied to clipboard!', 'success');
                } catch (err) {
                    showToast('Failed to copy JSON', 'error');
                }
            });
        }
        
        function generateExecutiveSummaryText(data) {
            let text = `${data.companyName}\nSector: ${data.sector}\n\n`;
            
            const sectionTitles = {
                overview: 'Company Overview',
                product: 'Product',
                businessModel: 'Business Model',
                marketOpportunity: 'Market Opportunity',
                traction: 'Traction & Metrics',
                team: 'Team'
            };
            
            Object.entries(data.sections).forEach(([key, bullets]) => {
                text += `${sectionTitles[key]}\n`;
                if (bullets.length === 0) {
                    text += 'üîπ Not specified\n';
                } else {
                    bullets.forEach(bullet => {
                        text += `üîπ ${bullet}\n`;
                    });
                }
                text += '\n';
            });
            
            return text;
        }
        
        // Copy functionality
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(extractedTextDiv.textContent);
                showToast('Text copied to clipboard!', 'success');
            } catch (err) {
                showToast('Failed to copy text', 'error');
            }
        });
        
        copyAnalysisBtn.addEventListener('click', async () => {
            try {
                // Copy the original content (markdown or text)
                const content = analysisTextDiv.innerHTML ? analysisTextDiv.textContent : analysisTextDiv.textContent;
                await navigator.clipboard.writeText(content);
                showToast('Analysis copied to clipboard!', 'success');
            } catch (err) {
                showToast('Failed to copy analysis', 'error');
            }
        });
        
        // Report Generation
        generateReportBtn.addEventListener('click', async () => {
            if (completedAgents.size !== 4) {
                showToast('Please complete all analyses first', 'error');
                return;
            }
            
            // Check cache first
            if (reportCache) {
                showReport(reportCache);
                return;
            }
            
            // Show loading state
            const btnText = generateReportBtn.querySelector('.btn-text');
            const btnLoading = generateReportBtn.querySelector('.btn-loading');
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');
            generateReportBtn.disabled = true;
            
            showLoading('Generating Comprehensive Report', 'Merging all analyses into a beautiful report...');
            
            // Start progress for report generation
            simulateProgress(25, 1000);
            
            try {
                // Prepare the request data
                const requestData = {
                    pitchdeck_analysis: agentResults['pitchdeck']?.content || '',
                    product_analysis: agentResults['product']?.content || '',
                    web_research: agentResults['web-research']?.content || '',
                    market_analysis: agentResults['market-size']?.content || '',
                    company_name: agentResults['web-research']?.rawData?.company_name || null
                };
                
                simulateProgress(60, 1500);
                
                const response = await fetch('/generate_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                simulateProgress(90, 500);
                
                const data = await response.json();
                
                if (data.success) {
                    updateProgress(100);
                    
                    setTimeout(() => {
                        reportCache = data.comprehensive_report;
                        showReport(reportCache);
                        showToast('Comprehensive report generated!', 'success');
                    }, 300);
                } else {
                    showError(data.detail || 'Failed to generate report');
                }
            } catch (error) {
                showError('Report generation error: ' + error.message);
            } finally {
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
                generateReportBtn.disabled = false;
            }
        });
        
        // Report display functions
        function showReport(content) {
            reportContent.innerHTML = '';
            
            // Check if content appears to be markdown
            if (content.includes('#') || content.includes('**')) {
                reportContent.innerHTML = markdownToHtml(content);
            } else {
                reportContent.textContent = content;
            }
            
            showSection(reportDisplaySection);
        }
        
        // Report actions
        copyReportBtn.addEventListener('click', async () => {
            try {
                const content = reportContent.textContent || reportCache;
                await navigator.clipboard.writeText(content);
                showToast('Report copied to clipboard!', 'success');
            } catch (err) {
                showToast('Failed to copy report', 'error');
            }
        });
        
        downloadReportBtn.addEventListener('click', () => {
            try {
                const content = reportCache || reportContent.textContent;
                const blob = new Blob([content], { type: 'text/markdown' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'comprehensive-business-report.md';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showToast('Report downloaded!', 'success');
            } catch (err) {
                showToast('Failed to download report', 'error');
            }
        });
        
        backToResultsBtn.addEventListener('click', () => {
            showSection(resultsSection);
        });
        
        // Navigation
        backBtn.addEventListener('click', () => {
            showSection(resultsSection);
        });
        
        retryBtn.addEventListener('click', () => {
            showSection(uploadSection);
        });
    </script>
</body>
</html>